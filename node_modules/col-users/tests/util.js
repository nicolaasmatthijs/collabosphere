/**
 * Copyright 2015 UC Berkeley (UCB) Licensed under the
 * Educational Community License, Version 2.0 (the "License"); you may
 * not use this file except in compliance with the License. You may
 * obtain a copy of the License at
 *
 *     http://opensource.org/licenses/ECL-2.0
 *
 * Unless required by applicable law or agreed to in writing,
 * software distributed under the License is distributed on an "AS IS"
 * BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express
 * or implied. See the License for the specific language governing
 * permissions and limitations under the License.
 */

var assert = require('assert');

var TestsUtil = require('col-tests/lib/util');

/**
 * Assert that the me feed for a client can be retrieved
 *
 * @param  {Client}             client              The REST client to make the request with
 * @param  {Course}             course              The Canvas course the user is launched in
 * @param  {User}               [expectedUser]      The expected Collabosphere user that should be returned
 * @param  {Function}           callback            Standard callback function
 * @param  {Object}             callback.me         The me data as returned by the API
 * @throws {AssertionError}                         Error thrown when an assertion failed
 */
var assertGetMe = module.exports.assertGetMe = function(client, course, expectedUser, callback) {
  client.users.getMe(course, function(err, me) {
    assert.ok(!err);
    assert.strictEqual(me.course.canvas_course_id, course.id);
    if (expectedUser) {
      assert.strictEqual(me.id, expectedUser.id);
      assert.strictEqual(me.canvas_course_role, expectedUser.canvas_course_role);
      assert.strictEqual(me.canvas_full_name, expectedUser.canvas_full_name);
      assert.strictEqual(me.canvas_image, expectedUser.canvas_image);
      assert.strictEqual(me.bookmarklet_token, expectedUser.bookmarklet_token);
    }
    return callback(me);
  });
};

/**
 * Assert that the me feed for a client can be retrieved
 *
 * @param  {Client}             client          The REST client to make the request with
 * @param  {Course}             course          The Canvas course the user is launched in
 * @param  {Number}             code            The HTTP response code
 * @param  {Function}           callback        Standard callback function
 * @param  {Object}             callback.me     The me data as returned by the API
 * @throws {AssertionError}                     Error thrown when an assertion failed
 */
var assertGetMeFails = module.exports.assertGetMeFails = function(client, course, code, callback) {
  client.users.getMe(course, function(err, me) {
    assert.strictEqual(err.code, code);
    assert.ok(!me);
    return callback();
  });
};
